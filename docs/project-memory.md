# LiteEditor 프로젝트 메모리

이 문서는 LiteEditor 프로젝트의 개발 과정에서 생성된 중요한 메모리와 규칙을 기록한 파일입니다. 다음 개발 세션에서도 이 정보를 활용할 수 있도록 보관합니다.

## 프로젝트 규칙

### 개발 가이드라인

- HTML, Tailwind CSS, Shadcn UI, JavaScript, TypeScript, Electron 코드를 명확하고 가독성 높게 작성
- 웹 표준, 기술 스택에 대한 Best Practices 숙지 및 활용
- 항상 안정화된 최신 버전의 기술 사용
- 코드는 모듈화와 재사용성을 고려해 작성
- 성능보다 가독성을 우선
- 요청된 기능은 완전히 구현
- TODO, placeholder, 빠진 부분은 절대 남기지 않음
- 설명은 간결하게 유지

### 에디터 기능 요구사항

1. 이 에디터는 누구나 쉽게 소스 코드에 추가(Add-on)하여 사용할 수 있는 오픈소스 웹 에디터입니다.
2. 에디터 영역을 초기화한 후 contenteditable="true" 로 설정한 editor-div에서, 에디터의 기능을 클릭하면 표준 HTML 코드가 생성되어 해당 div 영역에 적용됩니다.
3. 모든 개발 코드는 .rules 파일의 내용을 기반으로 작성됩니다.
4. 마우스로 드래그하여 선택한 영역 또는 더블 클릭으로 지정한 영역에 대해 에디터 기능을 클릭했을 때 서식이 적용됩니다.
5. 각 에디터 기능에는 자체적인 단축키를 지정해야 합니다.
6. 모든 에디터 기능 아이콘은 언제든지 추가하거나 삭제할 수 있는 구조를 가져야 합니다.
7. 이 에디터는 사용자가 에디터 라이브러리를 다운로드 한 후 소스에서 간단히 추가한 뒤 설치할 수 있어야 합니다.
8. 프롬프트를 실행할 때, 별도로 언급하지 않는 한 기존 UI 요소를 해치거나, 레이어, 버튼, 기능 등을 임의로 삭제 또는 변경해서는 안 됩니다.
9. "되돌리기" 또는 "롤백" 명령을 실행하면, 현재 수행 중인 작업이 즉시 직전 상태로 복원되어야 합니다.
10. 아이콘을 클릭하여 태그가 적용된 상태에서도, 선택된 영역이 그대로 유지되어야 합니다.
11. 선택한 영역에 HTML 태그를 적용한 후, 동일한 선택 영역에서 같은 아이콘을 다시 클릭하면 이미 적용된 HTML 태그가 제거되어야 합니다.
12. 실행 취소 및 재실행(Undo/Redo) 기능은 OS에서 기본 제공하는 Command + Z, Command + Shift + Z와 동일하게 동작해야 합니다.
13. 폰트, 제목(Heading), 색상(Color), 정렬(Align)과 같이 별도의 설정 레이어를 가진 아이콘은, editor-div에서 선택한 텍스트 블록에 최종적으로 설정 레이어에서 선택된 HTML 코드가 적용되어야 합니다.
14. 서식 제거 아이콘은 선택된 블록에 적용된 html 코드를 제거합니다.
15. 새로운 기능을 추가하거나 수정할 때, 기존에 작성된 코드를 먼저 분석해서 영향도를 파악합니다.
16. 기능단위로 css, javascript, html 파일을 작성합니다.
17. 각 아이콘은 아이콘의 역할에 따라 .js 파일들을 분리하고 중복되는 소스들은 공통 컴포넌트로 작성한 뒤 제거합니다.
18. 각 기능들은 서로 영향을 받지 않도록 작성합니다. 특정 기능을 추가할 경우 다른 소스에 영향을 주면 안됩니다.

## 주요 메모리

### 사용자 지정 플러그인 순서 지원 기능 추가

LiteEditor의 core.js 파일을 수정하여 사용자가 지정한 순서대로 플러그인을 표시할 수 있도록 개선했습니다.

변경 전:
- PLUGIN_ORDER 배열에 정의된 순서대로 플러그인을 렌더링
- 사용자가 지정한 플러그인만 표시 (enabledPlugins에 포함된 경우)
- 플러그인 순서 변경 불가능

변경 후:
- 사용자가 지정한 enabledPlugins 배열의 순서대로 플러그인을 렌더링
- index.html에서 plugins 배열에 지정한 순서가 그대로 툴바에 반영됨
- 사용자가 원하는 순서대로 플러그인 배치 가능

이 수정으로 LiteEditor의 유연성이 향상되었으며, 사용자는 자신의 요구에 맞게 툴바를 완전히 커스터마이징할 수 있게 되었습니다.

### 동영상 삽입 기능 추가

LiteEditor에 동영상 삽입 기능을 위한 기본 구조를 추가했습니다:

1. core.js 파일에 media 플러그인 추가
   - PLUGIN_ORDER 배열에 'media' 추가
   - 아이콘 및 제목 설정 (live_tv 아이콘, '동영상 삽입' 제목)

2. movie.js 파일 생성
   - 플러그인 기본 구조 작성
   - 선택 영역 저장/복원 함수 구현
   - 실제 기능은 추후 구현 예정

3. index.html 파일 수정
   - LiteEditor.init() 호출 시 plugins 배열에 'media' 추가

4. loader.js 파일 수정
   - 스크립트 로드 목록에 'js/plugins/movie.js' 추가

이제 LiteEditor 초기화 시 media 플러그인이 활성화되어 툴바에 동영상 삽입 아이콘이 표시됩니다. 실제 동영상 삽입 기능은 추후 구현 예정입니다.

### 정렬 기능 더블클릭 버그 수정

LiteEditor의 정렬 기능에서 더블클릭 선택 시 다음 줄까지 정렬이 적용되는 버그를 해결했습니다.

문제 원인:
- 더블클릭으로 선택할 때 Range 객체가 선택된 단어 뿐만 아니라 뒤따르는 공백, 탭, 줄바꿈까지 포함함
- 예: "순서 있는 리스트 1" 텍스트를 더블클릭하면 실제로는 "순서 있는 리스트 1                " 까지 선택됨

해결 방법:
- adjustDoubleClickSelection() 함수 추가: 더블클릭 선택 감지 및 범위 조정
- 선택된 텍스트 뒤의 공백, 탭, 줄바꿈 제거하여 정확한 단어 범위만 선택
- 정렬 적용 전에 선택 영역 조정 후 정렬 명령 실행

이 수정으로 더블클릭 선택 시에도 정확한 텍스트 범위에만 정렬이 적용됩니다.

### 정렬 기능 버그 분석

LiteEditor의 align.js 파일 분석 결과, 더블클릭 시 정렬이 두 줄에 적용되는 문제는 더블클릭 이벤트가 단어 선택 시 DOM 구조에서 해당 단어를 포함한 전체 블록(paragraph)을 선택 대상으로 인식하는 것이 원인입니다. 이는 document.execCommand('justify'+alignType)가 선택된 영역의 부모 요소(commonAncestorContainer)에 정렬을 적용하기 때문입니다. 드래그로 선택할 때는 정확한 범위만 선택되지만, 더블클릭은 DOM 구조상 더 넓은 범위를 선택하게 됩니다.
