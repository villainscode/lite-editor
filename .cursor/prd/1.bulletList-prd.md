# Product Requirements Document (PRD) for Bullet List Editor Plugin

---

## 1. Purpose & Scope

**1.1 Purpose**  
이 PRD는 웹 기반 WYSIWYG 에디터에 "Bullet List Editor" 기능을 제공하기 위한 요구사항을 정의합니다. 제공된 HTML/JavaScript 코드를 분석하여, 다른 AI 기반 에디터 도구에서도 동일한 기능을 구현할 수 있도록 가이드합니다.

**1.2 Scope**  
- Unordered List 토글  
- 들여쓰기 / 내어쓰기 UI 버튼  
- Tab/Shift+Tab 키보드 단축키  
- 리스트 엔터 동작  
- 포커스 관리  

## 2. Background

웹 에디터 사용자들은 목록 작성, 계층적 구조 표현, 글 흐름 제어를 위해 불릿 리스트와 들여쓰기 기능을 자주 사용합니다. 제공 코드에서 `document.execCommand`를 활용한 간단한 구현 방식을 참고하여, 다른 에디터에서도 동일한 경험을 제공하고자 합니다.

## 3. Objectives

- 사용자 친화적인 인터페이스로 불릿 리스트 토글 및 들여쓰기 제어  
- 키보드 및 버튼 양방향 지원으로 생산성 향상  
- 기본 HTML/CSS 기반으로 쉽게 확장 및 커스터마이징 가능  

## 4. Key Features

### 4.1 Unordered List Toggle
- **위치**: 툴바 상단 '• 리스트 토글' 버튼  
- **동작**: 툴바 버튼 클릭 시 한 번 클릭으로 불릿 리스트 적용 및 선택 영역 유지, 다시 클릭 시 불릿 리스트 제거 및 선택 영역 유지
- **중요**: 선택 범위 내 모든 텍스트에 일관되게 적용되어야 하며, 선택 영역의 일부만 적용/해제되는 현상이 발생하면 안됨

### 4.2 Indentation Controls
- **Indent 버튼**: `document.execCommand('indent')`
- **Outdent 버튼**: `document.execCommand('outdent')`
- **위치**: 툴바에 각각 'Tab 들여쓰기', 'Shift+Tab 내어쓰기' 버튼

### 4.3 Keyboard Shortcuts
- **Tab** 키: 기본 동작 차단 후 `indent`
- **Shift+Tab**: 기본 동작 차단 후 `outdent`
- **Alt+U**: 불릿 리스트 토글 단축키

### 4.4 List Behavior on Enter
- **기본 contenteditable 동작 유지**:  
  - 첫 번째 Enter: 새 LI 생성  
  - 빈 LI에서 연속 두 번 Enter: 리스트 종료 후 새 문단 생성

### 4.5 Focus Management
- **Blur 시**: 에디터가 포커스를 잃으면 즉시 재집중하여 선택 영역 유지

## 5. User Interface

### 5.1 result tag
```
<ul>
    <li>도현체</li>
    <ul>
        <li>두번째 depth</li>
        <ul>
            <li>세번째 depth</li>
            <ul>
                <li>네번째 depth</li>
            </ul>
        </ul>
    </ul>
    <li>나눔고딕</li>
    <li>바탕체</li>
</ul>
```
- 버튼 간 간격, 폰트 사이즈, 커서 포인터 설정 필요

### 5.2 Editor Area
- `div#editor[contenteditable=true]`
- `ul`/`li` 요소 스타일: 깊이별 `disc`, `circle`, `square` 반복

## 6. Functional Requirements

| ID   | Requirement Description                                                                                | Priority |
|------|--------------------------------------------------------------------------------------------------------|----------|
| FR1  | 툴바 버튼 클릭 시 한 번 클릭으로 불릿 리스트 적용 및 선택 영역 유지, 다시 클릭 시 불릿 리스트 제거 및 선택 영역 유지 | High     |
| FR2  | 사용자가 툴바 버튼 클릭 시 들여쓰기(Indent) / 내어쓰기(Outdent)                                         | High     |
| FR3  | Tab/Shift+Tab 입력으로 Indent/Outdent 지원                                                            | High     |
| FR4  | Enter 입력 시 기본 리스트 동작 유지                                                                    | Medium   |
| FR5  | 에디터 Blur 후 자동 포커스 복원                                                                        | Medium   |
| FR6  | 선택 영역의 모든 라인에 균일하게 리스트 적용/해제가 이루어져야 함                                        | Critical |

## 7. Technical Requirements

- **Editable Container**: `contenteditable="true"`
- **Command Execution**: `document.execCommand` API 사용
- **스타일**: CSS를 통해 list-style-type 적용 (depth 1–3: `disc`, `circle`, `square`, 4+반복)
- **선택 영역 마커**: 선택 영역의 시작과 끝에 고유 마커를 삽입하여 리스트 적용 후에도 정확한 선택 영역 복원
- **범위 처리**: 선택한 모든 텍스트가 균일하게 같은 처리를 받도록 Range API 활용

## 8. Non-Functional Requirements

- **성능**: 버튼 클릭 및 키 입력 시 지연 없이 즉시 반응
- **접근성**: 키보드만으로 모든 기능 사용 가능
- **호환성**: 최신 브라우저 지원

## 9. Acceptance Criteria

1. 툴바 버튼 클릭으로 리스트 토글/들여쓰기/내어쓰기 기능이 동작해야 한다.  
2. Tab 및 Shift+Tab 키 입력으로 동일 기능이 수행되어야 한다.  
3. 첫 번째 Enter로 새 리스트 아이템, 빈 아이템에서 두 번째 Enter로 리스트 종료가 발생해야 한다.  
4. 에디터가 Blur된 후 포커스를 즉시 복원하여 편집 중인 위치를 유지해야 한다.  
5. 각 리스트 깊이에 맞는 CSS 스타일이 적용되어야 한다.
6. 선택된 영역은 해제가 되지 않아야 하고 한번 클릭시 리스트 적용, 다시 한번 클릭시 리스트 해제가 되어야 하고 선택 영역이 잘못 계산되서 제일 밑에 있는 텍스트가 선택이 안되는 등의 버그를 일으키면 안된다. 
7. 현재 기존에 작성된 코드는 @bulletList-bak.js 인데, 선택 영역을 반복해서 클릭할 때마다 마지막 텍스트 라인이 bullet list가 적용이 안되고 있으므로 한번 클릭의 범위 블록의 시작점과 끝점을 잘 저장했다가 중복해서 눌러도 동일하게 스타일 및 bullet list가 지속적으로 적용/해제 되어야 한다. 이 부분이 가장 중요함 
8. 참고할 html 파일은 /demo 하위의 bullet-demo.html 이고 이 파일과 같이 간결한 기술/기능을 구현한다. 
9. 에디터 영역의 모든 ul/ol 에 태그를 변화시키는 querySelectorAll을 쓰지 말고 선택 영역만 적용/해제 되어야 한다. 
10. 선택 영역 내 모든 텍스트 블록이 균일하게 리스트 처리되어야 하며, 반복 클릭 시 마지막 라인이 리스트에서 빠지는 문제가 없어야 한다.

## 10. 선택 영역 관리 세부 요구사항

### 10.1 선택 영역 문제 정의
- **현재 버그**: bullet list 버튼을 한번 클릭하면 정상 적용, 다시 클릭하면 정상 해제, 세 번째 클릭하면 맨 밑 라인(예: "Black Han Sans")이 리스트에서 제외되는 문제가 있음
- **원인**: `document.execCommand('insertUnorderedList')` 실행 후 선택 영역이 변경되어 일부 텍스트가 선택에서 제외됨

### 10.2 해결 방안
1. **선택 영역 마커 사용**:
   - 불릿 리스트 토글 전에 선택 영역의 시작과 끝에 특수 마커(data-selection-start, data-selection-end 속성이 있는 span 태그) 삽입
   - 명령 실행 후 마커를 찾아 원래 선택 영역을 정확히 복원
   - 모든 마커는 작업 완료 후 제거

2. **Range 객체 관리**:
   - 정확한 Range 객체 복제 및 관리로 선택 영역 정보 보존
   - setStartAfter와 setEndBefore 메서드를 통해 정확한 위치 지정

3. **타이밍 고려**:
   - DOM 변경 후 선택 영역 복원 시 적절한 지연(setTimeout) 적용
   - 너무 빠른 처리는 DOM 업데이트 전에 선택 영역 복원 시도로 실패할 수 있음

### 10.3 구현 체크리스트
- [ ] 선택 영역 시작/끝 마커 삽입 로직
- [ ] 명령 실행 후 마커 기반 선택 영역 복원
- [ ] 마커 제거 및 정리
- [ ] 오류 처리(마커 찾기 실패 등)
- [ ] 적절한 타이밍 조정(setTimeout 등)

## 11. Future Considerations

- 사용자 정의 리스트 스타일(번호 리스트, 커스텀 아이콘) 지원  
- 모바일 터치 제스처 지원(스와이프 들여쓰기)  
- 플러그인 아키텍처 통합(모듈별 on/off 토글)
- 사용가능한 단축키는 alt+u 이고, tab과 shift+tab으로 들여쓰기와 내어쓰기가 지원된다. 