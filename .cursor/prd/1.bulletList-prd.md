# Bullet List 플러그인 기능 명세서 (PRD)

## 1. 개요
불릿 리스트 플러그인은 텍스트 에디터에서 목록 형식 서식을 적용하고 관리하는 기능을 제공합니다. 본 플러그인은 선택 영역 유지, 토글 기능, 중첩 리스트 지원, 깊이별 스타일 변경 등 사용자 경험을 향상시키는 다양한 기능을 포함합니다.

## 2. 핵심 기능

### 2.1 불릿 리스트 토글
- 선택한 텍스트 블록에 불릿 리스트 서식 적용/해제
- 서식 적용 후에도 원래 선택 영역 유지
- 다중 라인 선택 시 모든 라인이 균일하게 처리되어야 함
- 중첩된 콘텐츠 처리 지원 (내부 UL 요소 포함)

### 2.2 데이터 속성 기반 격리된 스타일 적용
- `data-lite-editor-bullet` 속성을 사용하여 해당 리스트에만 스타일 적용
- 문서의 다른 ul 요소에 영향을 주지 않도록 정교한 선택자 사용
- 직접 스타일 적용과 클래스 기반 스타일 병행 적용

### 2.3 중첩 깊이별 스타일 자동 적용
- 깊이에 따라 다른 불릿 스타일 적용 (1→disc, 2→circle, 3→square)
    •	1 depth: ● (disc)
    •	2 depth: ○ (circle)
    •	3 depth: ■ (square)
    •	4 depth 이후부터는 다시 ●, ○, ■ 순으로 반복

- 깊이가 3 이상일 경우 스타일 순환 (4→disc, 5→circle...)
- `data-depth` 속성으로 깊이 정보 저장 및 추적
- CSS 클래스와 인라인 스타일 병행 적용으로 일관된 시각적 표현

### 2.4 Tab/Shift+Tab 들여쓰기 기능
- Tab 키: 선택된 리스트 아이템 들여쓰기 (하위 레벨로 이동)
- Shift+Tab 키: 리스트 아이템 내어쓰기 (상위 레벨로 이동)
- 작업 후 포커스 및 선택 영역 유지
- 쓰로틀링 적용으로 빠른 키 입력 시 성능 보장
- 빈 중첩 UL 요소 자동 정리

## 3. 기술적 구현 사항

### 3.1 선택 영역 관리
- DOM 직접 조작 방식으로 리스트 생성/제거
- `document.execCommand` 사용하지 않고 직접 DOM 조작으로 정확한 선택 영역 유지
- 마커 요소를 사용하여 변환 전후 위치 추적 (`data-unwrap-marker`, `data-selection-marker`)
- 콘텐츠 변환 시 innerHTML 대신 childNodes 복제 방식 사용 (콘텐츠 완전 보존)
- 콜랩스된 범위(선택 없음) 시 현재 블록 전체를 대상으로 처리

### 3.2 스타일 관리
- CSS 스타일은 `[data-lite-editor-bullet]` 선택자를 사용하여 플러그인 리스트에만 적용
- !important 규칙으로 일관된 스타일 적용 보장
- 클래스 사용과 인라인 스타일 병행으로 다양한 환경 호환성 확보
- 재귀적 깊이 계산 알고리즘으로 중첩 리스트 스타일 자동 적용
- 중첩 UL이 있는 경우 하위 모든 UL에도 적절한 스타일 일괄 적용

### 3.3 이벤트 처리
- 이벤트 중복 실행 방지 (`stopImmediatePropagation` 포함)
- 지연 처리(setTimeout)로 DOM 업데이트 후 안정적인 선택 영역 복원
- 키보드 Tab/Shift+Tab 이벤트 캡처링 단계에서 처리 (우선순위 확보)
- 쓰로틀링으로 빈번한 키 입력 시 성능 저하 방지 (100ms)

### 3.4 포커스 유지 메커니즘
- 재귀적 텍스트 노드 탐색으로 정확한 커서 위치 복원
- 자식 요소가 복잡한 구조일 때도 정확한 텍스트 노드 찾기
- 빈 텍스트 노드 없을 경우 제로 너비 공백(`\u200B`) 삽입
- PluginUtil.selection 유틸리티를 활용한 안전한 선택 처리

## 4. 우선 요구사항

### 4.1 필수 요구사항
- 선택 영역에만 영향을 미치고 문서의 다른 부분은 변경되지 않아야 함
- 버튼 클릭으로 리스트 적용/해제 토글이 가능해야 함
- 적용/해제 후에도 원래 선택한 영역이 정확히 유지되어야 함
- 반복 토글 시에도 모든 선택 라인이 정확히 처리되어야 함 (마지막 라인 누락 현상 없어야 함)
- 중첩 깊이에 따른 스타일 변화가 시각적으로 명확해야 함

### 4.2 추가 요구사항
- 빈 선택 영역(collapsed)에서는 현재 블록 요소 전체에 적용
- 중첩 리스트 요소 내에서도 정확한 토글 기능
- Tab/Shift+Tab으로 들여쓰기/내어쓰기 지원
- 불필요한 빈 UL 요소 자동 정리
- 성능 저하 없이 대용량 문서에서도 원활하게 작동

## 5. 테스트 시나리오

### 5.1 기본 기능 테스트
- 여러 라인 선택 후 불릿 리스트 적용/해제
- 빈 선택 영역에서 불릿 리스트 적용
- 기존 리스트 선택 후 해제
- 해제 후 다시 적용
- 다양한 중첩 깊이에서 스타일 적용 확인

### 5.2 들여쓰기/내어쓰기 테스트
- Tab 키로 리스트 아이템 들여쓰기
- Shift+Tab 키로 리스트 아이템 내어쓰기
- 최상위 레벨에서 Shift+Tab 시 동작 확인 (내어쓰기 불가)
- 들여쓰기 후 스타일 변화 확인
- 연속 들여쓰기/내어쓰기 시 성능 및 안정성 확인

### 5.3 선택 영역 테스트
- 여러 라인 선택 후 반복 토글 테스트 (3회 이상)
- 리스트 적용/해제 후 선택 영역 확인
- 중첩된 블록 요소가 포함된 선택 영역 처리 테스트
- 들여쓰기/내어쓰기 후 포커스 위치 확인

### 5.4 특수 케이스 테스트
- 중첩 리스트 내부 요소 선택 및 토글
- 이미 리스트 형식인 텍스트와 일반 텍스트 함께 선택 후 처리
- 빈 라인 포함한 선택 영역 처리
- 복잡한 HTML 구조 포함된 콘텐츠 처리 확인
- 빠른 연속 키 입력 시 안정성 확인

## 6. 주의사항

### 6.1 구현 과정 주의사항
- 전역 스타일 오염 방지: 항상 `[data-lite-editor-bullet]` 속성으로 범위 한정
- 이벤트 전파 제어: `stopImmediatePropagation`으로 중복 실행 방지
- DOM 직접 조작 시 모든 콘텐츠가 보존되도록 주의
- 마지막 라인 누락 방지를 위한 정확한 범위 계산

### 6.2 잠재적 문제 영역
- 복잡한 중첩 구조에서 토글 시 구조 유지 확인
- 브라우저 호환성 고려 (특히 이벤트 처리 부분)
- 다른 포매팅 플러그인과의 상호작용 테스트
- 대용량 문서에서 성능 영향 최소화

## 7. 향후 개선사항
- 번호 매기기 리스트(ol) 지원
- 사용자 정의 불릿 아이콘 지원
- 키보드 단축키 확장 (Alt+Shift+U 등)
- 모바일 터치 이벤트 지원
- 드래그 앤 드롭으로 리스트 아이템 재정렬 기능 