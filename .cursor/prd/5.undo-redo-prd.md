# LiteEditor Undo/Redo 기능 PRD (Product Requirements Document)

## 📌 기능 개요

LiteEditor에 사용자 정의 Undo/Redo 시스템을 추가하여, 사용자 입력 뿐 아니라 커스텀 요소 삽입(예: `<hr>`, `<img>`, `<table>`)까지 안정적으로 복원할 수 있는 편집 기록 관리 기능을 제공한다.

---

## 1. 🎯 제품 목표

- 사용자가 다양한 입력/편집 행위를 했을 때 해당 상태를 기록하고, Undo/Redo 버튼을 통해 이전/다음 상태로 전환 가능하도록 한다.
- `contenteditable` 특성을 고려하여 텍스트 입력뿐 아니라 플러그인 삽입/제거 등도 포함한다.
- 시스템 기본 Undo/Redo를 대체하고, 제어 가능한 사용자 히스토리 시스템을 구축한다.

---

## 2. 📋 주요 기능 목록

| 기능명 | 설명 | 포함 여부 |
|--------|------|-----------|
| 텍스트 입력 기록 | 사용자의 타이핑 기록 저장 | ✅ |
| 이미지/라인 등 삽입 기록 | `<hr>`, `<img>` 등 사용자 삽입 요소 저장 | ✅ |
| DOM 상태 전체 저장 | `innerHTML` 기준 전체 상태 스냅샷 저장 | ✅ |
| Undo 스택 최대 갯수 제한 | 기본 100개 기록 제한 | ✅ |
| Redo 스택 지원 | Undo 후 되돌리기 가능 | ✅ |
| 히스토리 비활성화 모드 | 프로그램적 삽입 시 기록 제외 가능 | ✅ |
| 사용자 편집 위치 복원 | range 저장 후 상태 복원 시 위치까지 복원 | ✅(옵션) |
| 키보드 단축키 지원 | `Ctrl+Z`, `Ctrl+Shift+Z` 지원 | ✅ |
| 툴바 버튼 연결 | Undo, Redo 버튼 UI와 연결 | ✅ |

---

## 3. 🛠 기술 사양

- 저장 단위: `contentArea.innerHTML`
- 최대 스택 크기: 기본 100개 (`HistoryManager.max`)
- 사용자 삽입 시: `recordState()` 명시적으로 호출 필요
- 복원 방식: `contentArea.innerHTML = snapshot`

---

## 4. 🧩 인터페이스 정의

```js
class HistoryManager {
  constructor(max = 100);
  recordState(html: string): void;
  undo(currentHtml: string): string | null;
  redo(currentHtml: string): string | null;
}
```

- 전역 인스턴스: `LiteEditor.history`
- 각 에디터별 상태 관리

---

## 5. 📦 모듈 구성

- `history.js` : 히스토리 관리 전용 클래스
- `plugin/history.js` : 플러그인 등록 + 버튼 렌더 + 단축키 이벤트 바인딩
- `utils/range.js` (옵션): 선택 영역 저장 및 복원 함수 모듈화

---

## 6. 🧪 테스트 시나리오

1. 텍스트 입력 → Undo → Redo
2. `<hr>` 삽입 → Undo → 복원 확인
3. 이미지 드래그 삽입 → Undo
4. 여러 번 입력 후 Undo 5회 → Redo 5회
5. Undo 후 새 입력 → Redo 초기화됨 확인
6. 선택 영역 저장 → Undo → 커서 위치 복원

---

## 7. 🧭 향후 확장

- 선택 영역(`Range`) 저장 및 복원 기능 추가
- 히스토리 시각화 (Undo 리스트 보기)
- 로컬스토리지/세션스토리지 기반 임시 복구 기능

---

## 8. 📅 일정 (예시)

| 일자 | 작업 | 담당 |
|------|------|------|
| Day 1 | HistoryManager 구현 | Backend |
| Day 2 | Undo/Redo 버튼 연결 및 테스트 | Frontend |
| Day 3 | 선택 영역 복원 기능 구현 | Frontend |
| Day 4 | 최종 통합 테스트 및 문서화 | All |

---

## ✅ 정의 완료 기준

- 텍스트/삽입/삭제 모두 Undo/Redo 가능
- 버튼 + 단축키로 모두 작동
- 최대 100개 스택 제한 확인
- 선택 영역 복원 (옵션) 확인
