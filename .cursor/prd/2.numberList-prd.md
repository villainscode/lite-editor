# Product Requirements Document (PRD) for Numbered List Editor Plugin

---

## 1. Purpose & Scope

**1.1 Purpose**  
이 PRD는 웹 기반 WYSIWYG 에디터에 “Numbered List Editor” 기능을 제공하기 위한 요구사항을 정의합니다. 제공된 HTML/JavaScript 코드를 분석하여, 다른 AI 기반 에디터 도구에서도 동일한 기능을 구현할 수 있도록 가이드합니다.

**1.2 Scope**  
- Ordered List 토글  
- 들여쓰기 / 내어쓰기 UI 버튼  
- Tab/Shift+Tab 키보드 단축키  
- 리스트 엔터 동작  
- 포커스 관리  

---

## 2. Background

웹 에디터 사용자들은 순서 있는 리스트(번호 리스트)를 통해 문서의 구조를 명확히 하고, 단계별로 나열된 항목을 표현할 때 번호 리스트 기능을 사용합니다. 제공 코드에서 `document.execCommand('insertOrderedList')`와 들여쓰기/내어쓰기 API를 활용한 간단한 구현 방식을 참고하여, 다른 에디터에서도 동일한 경험을 제공하고자 합니다.

---

## 3. Objectives

- 사용자 친화적인 인터페이스로 번호 리스트 토글 및 들여쓰기 제어  
- 버튼과 키보드 양방향 지원으로 생산성 향상  
- 기본 HTML/CSS 기반으로 쉽게 확장 및 커스터마이징 가능  

---

## 4. Key Features

### 4.1 Ordered List Toggle
- **위치**: 툴바의 ‘1. 번호 리스트 토글’ 버튼  
- **동작**:  
  - **한 번 클릭**: 선택 영역 또는 커서 위치에 순서 리스트(ol) 적용, 선택 영역 유지  
  - **다시 클릭**: 적용된 순서 리스트 해제, 원본 블록으로 복원, 선택 영역 유지  

### 4.2 Indentation Controls
- **Indent 버튼**: `document.execCommand('indent')`  
- **Outdent 버튼**: `document.execCommand('outdent')`  
- **위치**: 툴바에 ‘들여쓰기 (Tab)’, ‘내어쓰기 (Shift+Tab)’ 버튼  

### 4.3 Keyboard Shortcuts
- **Tab**: 기본 탭 이동 방지 후 `indent` 실행  
- **Shift+Tab**: `outdent` 실행  

### 4.4 List Behavior on Enter
- **contenteditable 기본 동작 유지**:  
  - **첫 번째 Enter**: 새 리스트 아이템 생성  
  - **빈 리스트 아이템에서 연속 두 번 Enter**: 리스트 종료 후 새 문단 생성  

### 4.5 Focus Management
- **blur 이벤트**: 에디터가 포커스를 잃으면 즉시 재집중하여 선택 영역 유지  

---

## 5. User Interface

### 5.1 result tag
```
<ol>
    <li>첫 번째 단락 예시입니다.</li>
    <ol>
        <li>첫번째 depth</li>
        <ol>
            <li>두번째 depth</li>
            <ol>
                <li>세번째 depth</li>
            </ol>
        </ol>
    </ol>
    <li>두 번째 단락 예시입니다.</li>
    <li>세 번째 단락 예시입니다.</li>
</ol>
```


### 5.2 Editor Area
- `div#editor[contenteditable=true]`  
- `ol`/`li` 요소 스타일:  
  - 1depth: `decimal`  
  - 2depth: `lower-alpha`  
  - 3depth: `lower-roman`  
  - 4depth 이상: 다시 `decimal` 순환  

---

## 6. Functional Requirements

| ID   | Description                                                                                                         | Priority |
|------|---------------------------------------------------------------------------------------------------------------------|----------|
| FR1  | 툴바 버튼 클릭 시 한 번 클릭으로 번호 리스트 적용 및 선택 유지, 다시 클릭 시 번호 리스트 해제 및 선택 유지      | High     |
| FR2  | 툴바 버튼 클릭 시 들여쓰기(Indent) / 내어쓰기(Outdent) 기능 수행                                                      | High     |
| FR3  | Tab/Shift+Tab 키 입력으로 Indent/Outdent 기능 수행                                                                    | High     |
| FR4  | Enter 키 입력 시 기본 리스트 동작(새 아이템 생성, 빈 아이템에서 리스트 종료) 유지                                    | Medium   |
| FR5  | 에디터 blur 후 자동 포커스 복원 및 선택 영역 유지                                                                    | Medium   |

---

## 7. Technical Requirements

- **Editable Container**: `contenteditable="true"` 속성 사용  
- **Command Execution**: `document.execCommand('insertOrderedList')`, `indent`, `outdent` 호출  
- **CSS Styling**: `list-style-type` 속성으로 깊이별 스타일 지정 및 순환 처리  
-  #editor ol { list-style-type: decimal; }
   #editor ol ol { list-style-type: lower-alpha; }
   #editor ol ol ol { list-style-type: lower-roman; }
   #editor ol ol ol ol { list-style-type: decimal; }


---

## 8. Non-Functional Requirements

- **Performance**: 버튼 클릭 및 키 조작 시 즉각 반응  
- **Accessibility**: 키보드만으로도 모든 기능 제어 가능  
- **Compatibility**: 최신 브라우저 지원

---

## 9. Acceptance Criteria

1. 툴바 버튼 클릭으로 번호 리스트 토글(한 번 적용, 다시 클릭 해제) 기능이 정상 동작해야 한다.  
2. 들여쓰기/내어쓰기 버튼과 Tab/Shift+Tab 키가 indent/outdent 을 수행해야 한다.  
3. Enter 키로 새 리스트 아이템 생성 및 빈 아이템에서 두 번 Enter 시 리스트 종료가 일어나야 한다.  
4. blur 후 자동으로 포커스 복원하여 선택 영역이 유지되어야 한다.  
5. 각 깊이에 맞는 번호 스타일(`decimal`, `lower-alpha`, `lower-roman`)이 적용되고 4depth 이상부터 순환해야 한다.  
6. 선택된 영역은 해제가 되지 않아야 하고 한번 클릭시 리스트 적용, 다시 한번 클릭시 리스트 해제가 되어야 하고 선택 영역이 잘못 계산되서 제일 밑에 있는 텍스트가 선택이 안되는 등의 버그를 일으키면 안된다. 
7. 현재 기존에 작성된 코드는 @bulletList-bak.js 인데, 선택 영역을 반복해서 클릭할 때마다 마지막 텍스트 라인이 bullet list가 적용이 안되고 있으므로 한번 클릭의 범위 블록의 시작점과 끝점을 잘 저장했다가 중복해서 눌러도 동일하게 스타일 및 bullet list가 지속적으로 적용/해제 되어야 한다. 이 부분이 가장 중요함 
8. 참고할 html 파일은 /demo 하위의 bullet-demo.html 이고 이 파일과 같이 간결한 기술/기능을 구현한다. 
9. 에디터 영역의 모든 ul/ol 에 태그를 변화시키는 querySelectorAll을 쓰지 말고 선택 영역만 적용/해제 되어야 한다. 

---
## 10. 선택 영역 관리 세부 요구사항

### 10.1 선택 영역 문제 정의
- **현재 버그**: bullet list 버튼을 한번 클릭하면 정상 적용, 다시 클릭하면 정상 해제, 세 번째 클릭하면 맨 밑 라인(예: "Black Han Sans")이 리스트에서 제외되는 문제가 있음
- **원인**: `document.execCommand('insertorderedList')` 실행 후 선택 영역이 변경되어 일부 텍스트가 선택에서 제외됨

### 10.2 해결 방안
1. **선택 영역 마커 사용**:
   - 불릿 리스트 토글 전에 선택 영역의 시작과 끝에 특수 마커(data-selection-start, data-selection-end 속성이 있는 span 태그) 삽입
   - 명령 실행 후 마커를 찾아 원래 선택 영역을 정확히 복원
   - 모든 마커는 작업 완료 후 제거

2. **Range 객체 관리**:
   - 정확한 Range 객체 복제 및 관리로 선택 영역 정보 보존
   - setStartAfter와 setEndBefore 메서드를 통해 정확한 위치 지정

3. **타이밍 고려**:
   - DOM 변경 후 선택 영역 복원 시 적절한 지연(setTimeout) 적용
   - 너무 빠른 처리는 DOM 업데이트 전에 선택 영역 복원 시도로 실패할 수 있음

### 10.3 구현 체크리스트
- [ ] 선택 영역 시작/끝 마커 삽입 로직
- [ ] 명령 실행 후 마커 기반 선택 영역 복원
- [ ] 마커 제거 및 정리
- [ ] 오류 처리(마커 찾기 실패 등)
- [ ] 적절한 타이밍 조정(setTimeout 등)

## 11. Future Considerations

- 사용자 정의 리스트 스타일(번호 리스트, 커스텀 아이콘) 지원  
- 모바일 터치 제스처 지원(스와이프 들여쓰기)  
- 플러그인 아키텍처 통합(모듈별 on/off 토글)
- 사용가능한 단축키는 alt+o 이고, tab과 shift+tab으로 들여쓰기와 내어쓰기가 지원된다. 

